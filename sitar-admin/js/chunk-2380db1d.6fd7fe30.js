(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2380db1d"],{"0c98":function(e,t,n){},2532:function(e,t,n){"use strict";var r=n("23e7"),a=n("5a34"),c=n("1d80");r({target:"String",proto:!0,forced:!n("ab13")("includes")},{includes:function(e){return!!~String(c(this)).indexOf(a(e),arguments.length>1?arguments[1]:void 0)}})},3786:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return l})),n("99af"),n("d3b7");var r=n("0c6d"),a=n("a1bc"),c=n("5308"),i=a.SESSION_STORAGE_KEYS.WX_TOKEN,s=a.SESSION_STORAGE_KEYS.MINI_TOKEN;function o(e,t,n){return new Promise((function(a,o){Object(r.a)({url:"/token?grant_type=client_credential&appid=".concat(e,"&secret=").concat(t),method:"get"}).then((function(e){var t=e.access_token,r=e.expires_in,o={expireTime:(new Date).getTime()+3*r/4*1e3,accessToken:t},u="wx"===n?i:s;Object(c.d)(u,JSON.stringify(o)),a(t)})).catch(o)}))}function u(e,t){return o(e,t,"wx")}function l(e,t){return o(e,t,"mini")}},"5a34":function(e,t,n){var r=n("44e7");e.exports=function(e){if(r(e))throw TypeError("The method doesn't accept regular expressions");return e}},"88fc":function(e,t,n){"use strict";var r=n("0c98");n.n(r).a},"98e1":function(e,t,n){"use strict";n.r(t),n("99af"),n("4de4"),n("4160"),n("caad"),n("b64b"),n("2532"),n("159b"),n("96cf");var r=n("1da1"),a=(n("d81d"),n("d3b7"),n("5530")),c=n("6b75");n("a4d3"),n("e01a"),n("d28b"),n("a630"),n("e260"),n("3ca3"),n("ddb0");var i=n("06c5");function s(e){return function(e){if(Array.isArray(e))return Object(c.a)(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(i.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var o=n("0c6d");function u(e){return l.apply(this,arguments)}function l(){return(l=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r,c,i,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:1,r=s.length>2&&void 0!==s[2]?s[2]:20,c="/wx-api/material/batchget_material",i={type:t,offset:(n-1)*r,count:r},e.abrupt("return",new Promise((function(e,n){Object(o.a)({url:c,method:"post",data:i}).then((function(n){var r=n.item.map((function(e){return Object(a.a)({},e,{material_type:t})}));e(r)})).catch(n)})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){return d.apply(this,arguments)}function d(){return(d=Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){Object(o.a)({url:"/wx-api/material/get_materialcount",method:"get"}).then((function(t){e({voice:t.voice_count,video:t.video_count,image:t.image_count,news:t.news_count})})).catch(t)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){var t=[],n=[],r=[],c=[];return e.forEach((function(e){var i=e.media_id,o=e.content,u=e.update_time,l=e.material_type,p=1e3*u;if(e.timestamp=p,"news"===l){var d=o.news_item;t.push.apply(t,s(d.map((function(e,t){return Object(a.a)({},e,{media_id:i,news_item_index:t,real_id:"".concat(i,"_").concat(t),update_time:u,timestamp:p})}))))}else"image"===l?n.push(e):"video"===l?c.push(e):"voice"===l&&r.push(e)})),{news:t,image:n,voice:r,video:c}}n("e3f5");var m=n("3786"),b=n("9d15"),v=n("432e"),h=n("5308"),y=n("a1bc"),g={video:function(e,t){return u("video",e,t)},image:function(e,t){return u("image",e,t)},voice:function(e,t){return u("voice",e,t)},news:function(e,t){return u("news",e,t)}},_={video:y.COLLECTIONS.VIDEO_RAW,news:y.COLLECTIONS.NEWS_RAW,image:y.COLLECTIONS.IMAGE_RAW,voice:y.COLLECTIONS.VOICE_RAW},w={name:"",components:{},filters:{},mixins:[],props:[],data:function(){return{appid:"wx98908bfb76102166",secret:"9ebe8100bded82824f16598853dcd483",wxToken:"",syncLog:"",countLog:"",syncNewsCount:10,syncImageCount:20}},computed:{},watch:{},beforeCreate:function(){},created:function(){},mounted:function(){this.checkToken()},beforeUpdate:function(){},methods:{handleGetToken:function(){var e=this;if(!this.appid||!this.secret)return this.$warn("输入 APPID 和 SECRET");Object(m.b)(this.appid,this.secret).then((function(){e.$success("获取成功"),e.appid="",e.secret="",e.checkToken()})).catch(this.$message.error)},checkToken:function(){this.wxToken=Object(h.c)()},getCount:function(){var e=this;this.countLog="",p().then((function(t){Object.keys(t).forEach((function(n){e.countLog+="".concat(n,": ").concat(t[n],"<br/>")}))})).catch(this.$message.error)},handleSync:function(e,t){var n=this;this.$confirm("确定同步？？？","提示！！！").then((function(){n.syncLog="",p().then(function(){var a=Object(r.a)(regeneratorRuntime.mark((function r(a){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t?(n.syncLog+="同步数量参考值：<br/>","all"===e?Object.keys(a).forEach((function(e){n.syncLog+="".concat(e,": ").concat(a[e],"<br/>")})):n.syncLog+="".concat(e,": ").concat(a[e],"<br/>"),n.fullSync(e,a)):n.incSync(e,a);case 1:case"end":return r.stop()}}),r)})));return function(e){return a.apply(this,arguments)}}()).catch(n.$message.error)}))},fullSync:function(e,t){var n=this;return Object(r.a)(regeneratorRuntime.mark((function r(){var a,c,i,s,o,u,l,p,d,m,b,h,y,w,k,x,O;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n.syncLog+="开始获取微信素材...<br/>",a=[],c=[],i=Object.keys(t),s=0,o=i;case 5:if(!(s<o.length)){r.next=32;break}if(u=o[s],"all"!==e&&("all"===e||u!==e)){r.next=29;break}l=g[u],p=!0,d=0;case 11:if(!p){r.next=29;break}return m=d/20+1,b=[],r.prev=14,r.next=17,l(m,20);case 17:b=r.sent,r.next=24;break;case 20:r.prev=20,r.t0=r.catch(14),c.push(r.t0);case 24:b.length<20&&(p=!1),d+=20,a=a.concat(b),r.next=11;break;case 29:s++,r.next=5;break;case 32:n.syncLog+="获取完成，开始格式化...<br/>",h=f(a),n.syncLog+="开始更新数据库...<br/>",r.prev=35,y=0,w=i;case 37:if(!(y<w.length)){r.next=48;break}if(k=w[y],"all"!==e&&("all"===e||k!==e)){r.next=45;break}if(x=_[e],!(O=h[e]).length){r.next=45;break}return r.next=45,Object(v.g)(O,x);case 45:y++,r.next=37;break;case 48:n.syncLog+="同步完成<br/>",r.next=54;break;case 51:r.prev=51,r.t1=r.catch(35),n.$message.error(r.t1);case 54:case"end":return r.stop()}}),r,null,[[14,20],[35,51]])})))()},incSync:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,a,c,i,s,o,u,l,p;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:n.prev=0,t.syncLog+="开始获取微信素材...<br/>",r=0,n.t0=e,n.next="image"===n.t0?6:"news"===n.t0?8:10;break;case 6:return r=t.syncImageCount,n.abrupt("break",12);case 8:return r=t.syncNewsCount,n.abrupt("break",12);case 10:return r=0,n.abrupt("break",12);case 12:return a=g[e],n.next=15,a(1,r);case 15:return c=n.sent,t.syncLog+="获取完成，开始格式化...<br/>",i=f(c),s=i[e],t.syncLog+="开始查重...<br/>",n.next=22,Object(v.d)(e,r);case 22:if(o=n.sent,u=s.filter((function(e){var t=e.media_id;return!o.includes(t)})),0!==(l=u.length)){n.next=28;break}return t.syncLog+="无新项目",n.abrupt("return");case 28:return t.syncLog+="新增".concat(l,"条，开始更新数据库...<br/>"),p=_[e],n.next=32,Object(v.b)(u,p);case 32:t.syncLog+="同步完成<br/>",n.next=38;break;case 35:n.prev=35,n.t1=n.catch(0),t.$error(n.t1);case 38:case"end":return n.stop()}}),n,null,[[0,35]])})))()},handleUpdateVersion:function(){var e=(new Date).getTime(),t="\n      db.collection('".concat(y.COLLECTIONS.SETTING,"')\n      .where({\n        setting_name: 'version'\n      })\n      .update({\n        data: {\n          version: \"").concat(e,'",\n        }\n      })\n      ');Object(b.b)(t).then(this.$success).catch(this.$error)}}},k=(n("88fc"),n("2877")),x=Object(k.a)(w,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"view-sync"},[n("div",{staticClass:"section"},[n("div",{staticClass:"section__title"},[e._v("同步公众号数据")]),n("div",{staticClass:"sub-section"},[n("el-form",{attrs:{inline:""}},[n("el-form-item",[n("el-input",{attrs:{name:"username",type:"text",size:"small",placeholder:"微信 appid"},model:{value:e.appid,callback:function(t){e.appid=t},expression:"appid"}})],1),n("el-form-item",[n("el-input",{attrs:{name:"password",type:"password",size:"small",placeholder:"微信 appsecret","show-password":""},model:{value:e.secret,callback:function(t){e.secret=t},expression:"secret"}})],1),n("el-form-item",[n("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleGetToken}},[e._v("获取公众号 token")])],1)],1),e.wxToken?n("el-tag",{attrs:{type:"success"}},[e._v("已获取公众号 token")]):n("el-tag",{attrs:{type:"danger"}},[e._v("得先获取公众号 token")])],1),n("div",{staticClass:"sub-section"},[n("div",{staticClass:"sub-section__title"},[e._v("查看素材数量")]),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.getCount}},[e._v("查询")]),n("div",{domProps:{innerHTML:e._s(e.countLog)}})],1),n("div",{staticClass:"sub-section"},[n("div",{staticClass:"sub-section__title"},[e._v("所有素材")]),n("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.handleSync("all",!0)}}},[e._v("全量同步")])],1),n("div",{staticClass:"sub-section"},[n("div",{staticClass:"sub-section__title"},[e._v("图文素材")]),n("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(t){return e.handleSync("news",!0)}}},[e._v("全量同步")]),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.handleSync("news",!1)}}},[e._v("增量同步")]),n("el-input",{staticStyle:{width:"unset"},attrs:{size:"small"},model:{value:e.syncNewsCount,callback:function(t){e.syncNewsCount=t},expression:"syncNewsCount"}},[n("template",{slot:"prepend"},[e._v("前")]),n("template",{slot:"append"},[e._v("条")])],2)],1),n("div",{staticClass:"sub-section"},[n("div",{staticClass:"sub-section__title"},[e._v("图片素材")]),n("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(t){return e.handleSync("image",!0)}}},[e._v("全量同步")]),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.handleSync("image",!1)}}},[e._v("增量同步")]),n("el-input",{staticStyle:{width:"unset"},attrs:{size:"small"},model:{value:e.syncImageCount,callback:function(t){e.syncImageCount=t},expression:"syncImageCount"}},[n("template",{slot:"prepend"},[e._v("前")]),n("template",{slot:"append"},[e._v("条")])],2)],1),n("div",{domProps:{innerHTML:e._s(e.syncLog)}})]),n("div",{staticClass:"section"},[n("div",{staticClass:"section__title"},[e._v("更新缓存版本")]),e._v(" 修改后需要更新缓存版本，否则小程序端看到的是缓存的旧内容 "),n("br"),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleUpdateVersion}},[e._v("更新缓存版本")])],1)])}),[],!1,null,null,null);t.default=x.exports},ab13:function(e,t,n){var r=n("b622")("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,"/./"[e](t)}catch(e){}}return!1}},caad:function(e,t,n){"use strict";var r=n("23e7"),a=n("4d64").includes,c=n("44d2");r({target:"Array",proto:!0,forced:!n("ae40")("indexOf",{ACCESSORS:!0,1:0})},{includes:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),c("includes")}}]);