(()=>{"use strict";function t(e){const{tag:i,attributes:r,listeners:o,children:a,...n}=e;if(!i)return a;const s=document.createElement(i);return r&&Object.keys(r).forEach((t=>{s.setAttribute(t,r[t])})),o&&Object.keys(o).forEach((t=>{s[t]=o[t]})),a&&a.map(t).forEach((t=>{s.appendChild(t)})),n&&Object.keys(n).forEach((t=>{s[t]=n[t]})),s}const e=`https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=${"localhost"===window.location.hostname?"bebfea7f-4c55-4f5b-b553-42b852baf849":"a8e98bd0-7d39-4b69-84aa-0798b94b0f5d"}&response_type=token&redirect_uri=${"localhost"===window.location.hostname?"http://localhost:8080":"https://harrisoff.github.io/onedrive.html"}&scope=openid https://graph.microsoft.com/Files.ReadWrite.All`;axios.interceptors.response.use((t=>t),(t=>(alert(t.response.statusText),Promise.reject(t))));const i={"zh-CN":{filename:"文件名",dir:"目标文件夹",upload:"上传",getUrl:"获取链接",imageId:"图片 ID",url:"链接"},en:{filename:"filename",dir:"target directory",upload:"upload",getUrl:"get url",imageId:"image id",url:"url"}};!function(){const r=function(){const t=window.location.href.split("#")[1];if(!t)return{};const e=new URLSearchParams(`?${t}`);return new Proxy(e,{get:(t,e)=>t.get(e)})}(),{error:o}=r,a=r.access_token,n=r.error_description;if(o&&n){const e=t({tag:"div",children:[{tag:"p",innerText:o},{tag:"p",innerText:n}]});document.querySelector("#root").appendChild(e)}else if(a){const e=i[navigator.language]||i.en,{filename:r,dir:o,upload:n,getUrl:s,imageId:l,url:c}=e,u=t({tag:"div",attributes:{class:"container",style:"padding-top: 20px"},children:[{tag:"div",attributes:{class:"form-group"},children:[{tag:"input",attributes:{type:"file",id:"file-selector",accept:"image/*"},listeners:{onchange:async function(){document.querySelector("#img-id").value="",document.querySelector("#img-link").value="";const t=this.files[0],e=document.querySelector("#img-local"),i=document.querySelector("#filename");if(t){const r=await function(t){return new Promise((e=>{const i=new FileReader;i.readAsDataURL(t),i.onloadend=()=>{e(i)}}))}(t);e.setAttribute("src",r.result),e.style.display="block",i.value=t.name}else e.style.display="none",i.value=""}}},{tag:"img",attributes:{src:"",id:"img-local",style:"max-width:300px;max-height:300px;padding-top: 20px;display: none;"}}]},{tag:"div",attributes:{class:"form-group"},children:[{tag:"label",attributes:{for:"filename"},innerText:r},{tag:"input",attributes:{type:"text",class:"form-control",id:"filename"}}]},{tag:"div",attributes:{class:"form-group"},children:[{tag:"label",attributes:{for:"dir"},innerText:o},{tag:"input",attributes:{type:"text",class:"form-control",id:"dir"},value:"OneDriveApiDir"}]},{tag:"div",attributes:{class:"form-group"},children:[{tag:"button",attributes:{type:"button",class:"btn btn-primary",id:"upload"},listeners:{onclick:async function(){const t=document.querySelector("#file-selector").files[0],e=`${document.querySelector("#dir").value}/${t.name}`,i=document.querySelector("#img-id");let r;if(t.size>4e6){const{data:i}=await function(t,e){return axios({method:"POST",url:`https://graph.microsoft.com/v1.0/drive/root:/${t}:/createUploadSession`,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})}(e,a);r=await function(t,e,i){return axios({method:"PUT",url:e,data:t,headers:{"Content-Range":`bytes 0-${i-1}/${i}`}})}(t,i.uploadUrl,t.size)}else r=await function(t,e,i){return axios({method:"PUT",url:`https://graph.microsoft.com/v1.0/me/drive/root:/${e}:/content`,data:t,headers:{Authorization:`Bearer ${i}`}})}(t,e,a);i.value=r.data.id}},innerText:n},{tag:"button",attributes:{type:"button",class:"btn btn-primary",id:"get-link"},listeners:{onclick:async function(){const t=document.querySelector("#img-id"),{data:e}=await function(t,e){return axios({method:"POST",url:`https://graph.microsoft.com/v1.0/me/drive/items/${t}/createLink`,data:{type:"view",scope:"anonymous"},headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})}(t.value,a);document.querySelector("#img-link").value=`https://api.onedrive.com/v1.0/shares/${e.shareId}/root/content`}},innerText:s}]},{tag:"div",attributes:{class:"form-group"},children:[{tag:"label",innerText:l},{tag:"input",attributes:{type:"text",class:"form-control",id:"img-id",disabled:!0}}]},{tag:"div",attributes:{class:"form-group"},children:[{tag:"label",innerText:c},{tag:"input",attributes:{type:"text",class:"form-control",id:"img-link",disabled:!0}}]}]});document.querySelector("#root").appendChild(u)}else window.location.href=e}()})();
