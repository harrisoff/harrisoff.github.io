(()=>{"use strict";function t(e){const{tag:i,attributes:a,listeners:o,children:r,...n}=e;if(!i)return r;const s=document.createElement(i);return a&&Object.keys(a).forEach((t=>{s.setAttribute(t,a[t])})),o&&Object.keys(o).forEach((t=>{s[t]=o[t]})),r&&r.map(t).forEach((t=>{s.appendChild(t)})),n&&Object.keys(n).forEach((t=>{s[t]=n[t]})),s}const e=`https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=${"localhost"===window.location.hostname?"bebfea7f-4c55-4f5b-b553-42b852baf849":"a8e98bd0-7d39-4b69-84aa-0798b94b0f5d"}&response_type=token&redirect_uri=${"localhost"===window.location.hostname?"http://localhost:8080":"https://harrisoff.github.io/onedrive.html"}&scope=openid https://graph.microsoft.com/Files.ReadWrite.All`;axios.interceptors.response.use((t=>t),(t=>(alert(t.response.statusText),Promise.reject(t))));const i={"zh-CN":{filename:"文件名",dir:"目标文件夹",upload:"上传",getUrl:"获取链接",imageId:"图片 ID",url:"链接"},en:{filename:"filename",dir:"target directory",upload:"upload",getUrl:"get url",imageId:"image id",url:"url"}};!function(){const a=window.location.href.split("#")[1];if(a){const e=a.match(/(access_token=)([a-zA-Z0-9/%]*)/)[2],o=i[navigator.language]||i.en,{filename:r,dir:n,upload:s,getUrl:l,imageId:c,url:u}=o,d=t({tag:"div",attributes:{class:"container",style:"padding-top: 20px"},children:[{tag:"div",attributes:{class:"form-group"},children:[{tag:"input",attributes:{type:"file",id:"file-selector",accept:"image/*"},listeners:{onchange:async function(){document.querySelector("#img-id").value="",document.querySelector("#img-link").value="";const t=this.files[0],e=document.querySelector("#img-local"),i=document.querySelector("#filename");if(t){const a=await function(t){return new Promise((e=>{const i=new FileReader;i.readAsDataURL(t),i.onloadend=()=>{e(i)}}))}(t);e.setAttribute("src",a.result),e.style.display="block",i.value=t.name}else e.style.display="none",i.value=""}}},{tag:"img",attributes:{src:"",id:"img-local",style:"max-width:300px;max-height:300px;padding-top: 20px;display: none;"}}]},{tag:"div",attributes:{class:"form-group"},children:[{tag:"label",attributes:{for:"filename"},innerText:r},{tag:"input",attributes:{type:"text",class:"form-control",id:"filename"}}]},{tag:"div",attributes:{class:"form-group"},children:[{tag:"label",attributes:{for:"dir"},innerText:n},{tag:"input",attributes:{type:"text",class:"form-control",id:"dir"},value:"OneDriveApiDir"}]},{tag:"div",attributes:{class:"form-group"},children:[{tag:"button",attributes:{type:"button",class:"btn btn-primary",id:"upload"},listeners:{onclick:async function(){const t=document.querySelector("#file-selector").files[0],i=`${document.querySelector("#dir").value}/${t.name}`,a=document.querySelector("#img-id");let o;if(t.size>4e6){const{data:a}=await function(t,e){return axios({method:"POST",url:`https://graph.microsoft.com/v1.0/drive/root:/${t}:/createUploadSession`,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})}(i,e);o=await function(t,e,i){return axios({method:"PUT",url:e,data:t,headers:{"Content-Range":`bytes 0-${i-1}/${i}`}})}(t,a.uploadUrl,t.size)}else o=await function(t,e,i){return axios({method:"PUT",url:`https://graph.microsoft.com/v1.0/me/drive/root:/${e}:/content`,data:t,headers:{Authorization:`Bearer ${i}`}})}(t,i,e);a.value=o.data.id}},innerText:s},{tag:"button",attributes:{type:"button",class:"btn btn-primary",id:"get-link"},listeners:{onclick:async function(){const t=document.querySelector("#img-id"),{data:i}=await function(t,e){return axios({method:"POST",url:`https://graph.microsoft.com/v1.0/me/drive/items/${t}/createLink`,data:{type:"view",scope:"anonymous"},headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})}(t.value,e);document.querySelector("#img-link").value=`https://api.onedrive.com/v1.0/shares/${i.shareId}/root/content`}},innerText:l}]},{tag:"div",attributes:{class:"form-group"},children:[{tag:"label",innerText:c},{tag:"input",attributes:{type:"text",class:"form-control",id:"img-id",disabled:!0}}]},{tag:"div",attributes:{class:"form-group"},children:[{tag:"label",innerText:u},{tag:"input",attributes:{type:"text",class:"form-control",id:"img-link",disabled:!0}}]}]});document.querySelector("#root").appendChild(d)}else window.location.href=e}()})();